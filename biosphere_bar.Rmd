---
title: "Biosphere reserve"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(readxl)
library(janitor)
```

### Get data
```{r eval = TRUE}
extract_xls <- "data/DATA EXTRACTION FINAL.xlsx"
de <- read_excel(extract_xls, sheet = "Summary DE")
```

Count frequency in raw data
```{r get data column}
table(de$`Biosphere reserve`, useNA = 'always')
```

Remove NA, fix names and tidy values
```{r}
thisData <- de %>% 
  select('Biosphere reserve') %>% 
  drop_na()

names(thisData) <- 'Biosphere_reserve'
thisData[thisData == 'Komodo MPA',] <- 'Komodo'
thisData[thisData == 'Cat Tien (Dong Nai)',] <- 'Cat Tien'
```

Calculate proportion with frequency
```{r eval = TRUE, echo = TRUE}
thisTable <- tabyl(thisData$Biosphere_reserve)
names(thisTable)[1] <- 'Biosphere_reserve'
thisTable
```

```{r eval = FALSE, echo = FALSE}
labelled <-  theme(
  axis.title.x=element_blank(),
  axis.title.y=element_blank(),
  axis.text.y=element_blank(),
  axis.ticks.y=element_blank(),
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background = element_blank()
)

Name <- thisTable$Biosphere_reserve
Value <- thisTable$percent

df <-  data.frame(Name, Value) %>%
  mutate(Name = factor(Name, levels = Name),
         xPos = cumsum(lag(Value, default = 0)) + Value/2) # calculate interval position

country_label <- ggplot(data = df, aes(x = xPos, y = 0.12, 
                        width = Value, fill = Name)) +
  geom_col(position = "identity",
           show.legend = FALSE) +
  geom_text(aes(label = Name),
            position = position_fill(vjust = 0.16)) +
  labelled
  
ggsave(file="img/country_label.svg", plot=country_label)
country_label
```

```{r eval = FALSE, echo = FALSE}
country_label_img <- image_read('img/country_label_raw.png')
image_info(country_label_img)
tmp <- image_trim(country_label_img)
image_write(tmp, path='img/country_label.png', format='png')
image_info(tmp)
```
